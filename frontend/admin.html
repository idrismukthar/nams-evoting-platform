<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NAMS | Admin Dashboard</title>
    <link rel="stylesheet" href="css/admin_style.css" />
  </head>

  <body>
    <div class="admin-container">
      <h1>üó≥Ô∏è NAMS LASU Admin Panel</h1>
      <p>Add and manage candidates easily.</p>

      <!-- Add Candidate Form -->
      <form id="candidateForm" enctype="multipart/form-data">
        <input
          type="text"
          name="fullname"
          placeholder="Candidate name"
          required
        />
        <input
          type="text"
          name="position"
          placeholder="Position"
          required
        />
        <input type="file" name="image" accept="image/*" required />
        <button type="submit">Add Candidate</button>
      </form>

      <div id="message" class="msg-box"></div>

      <h2>üßæ Existing Candidates</h2>
      <div id="candidatesList" class="candidates-list">
        <!-- Candidate cards will appear here automatically -->
      </div>
    </div>

    <script>
      // ==================== LOAD CANDIDATES ====================
      async function loadCandidates() {
        const res = await fetch("http://localhost:4000/candidates");
        const candidates = await res.json();
        const list = document.getElementById("candidatesList");

        list.innerHTML = ""; // Clear old list

        if (candidates.length === 0) {
          list.innerHTML = "<p>No candidates yet.</p>";
          return;
        }

        candidates.forEach((c) => {
          const div = document.createElement("div");
          div.className = "candidate-card";
          div.dataset.id = c.id;

          div.innerHTML = `
            <img src="http://localhost:4000/uploads/${c.image}" alt="${c.name}" width="100">
            <p><strong>Name:</strong> ${c.name}</p>
            <p><strong>Position:</strong> ${c.position}</p>
            <button class="delete-btn">üóëÔ∏è Delete</button>
          `;

          list.appendChild(div);
        });
      }

      // ==================== ADD NEW CANDIDATE ====================
      const form = document.getElementById("candidateForm");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const msg = document.getElementById("message");
        const formData = new FormData(form);

        try {
          const res = await fetch("http://localhost:4000/addCandidate", {
            method: "POST",
            body: formData,
          });

          const data = await res.json();
          msg.textContent = data.message || data.error;
          msg.style.color = res.ok ? "green" : "red";

          if (res.ok) {
            form.reset();
            loadCandidates(); // refresh list
          }
        } catch (err) {
          msg.textContent = "‚ùå Failed to connect to server.";
          msg.style.color = "red";
        }
      });

      // ==================== DELETE CANDIDATE ====================
      document.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-btn")) {
          const card = e.target.closest(".candidate-card");
          const id = card.dataset.id;

          if (confirm("Are you sure you want to delete this candidate?")) {
            const res = await fetch(
              `http://localhost:4000/candidates/${id}`,
              { method: "DELETE" }
            );
            const data = await res.json();
            alert(data.message || data.error);

            if (res.ok) card.remove();
          }
        }
      });

      // ==================== INITIAL LOAD ====================
      loadCandidates();
    </script>
  </body>
</html>
